<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>Virac</title>

    <script src="https://aframe.io/releases/0.3.2/aframe.js"></script> <!--Main--->
    <script src="https://rawgit.com/donmccurdy/aframe-extras/master/dist/aframe-extras.loaders.min.js"></script> 
    <script src="https://cdn.rawgit.com/donmccurdy/aframe-extras/v2.6.1/dist/aframe-extras.min.js"></script> <!--Extra--->
    <script src="https://cdn.rawgit.com/zcanter/aframe-gradient-sky/master/dist/gradientsky.min.js"></script> <!--Weather--->
    <script src="https://rawgit.com/rdub80/aframe-gui/master/dist/aframe-gui.min.js"></script> <!--GUI--->
    <script src="map.js"></script> <!--Map--->
    
    

</head>
<body>
    <a-scene>

        <!--Include all Aframe assets here--->
        <a-assets>
            <img id="texture-floor" src="road2.jpg">
            <img id="texture-wall" src="house.jpg">
            <img id="hazard" src="hazard.png">
        </a-assets>

        <!--Camera entity--->
        <a-entity id="player"
                camera look-controls
                universal-controls="movementControls:gamepad, keyboard"
                kinematic-body
                position="0 0 0">
            <!--Cursor entity--->
            <a-entity id ="cursor"
                    cursor="fuse: true; fuseTimeout: 1000"
                    position="0 0 -1"
                    geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03"
                    material="color: black; shader: flat">
                <a-animation begin="click" easing="ease-in" attribute="scale" fill="backwards" from="0.1 0.1 0.1" to="1 1 1"></a-animation>
                <a-animation begin="cursor-fusing" easing="ease-in" attribute="scale"fill="forwards" from="1 1 1" to="0.1 0.1 0.1"></a-animation>   
            </a-entity>
            <!--Heads up display entities---> 
            <a-entity geometry="primitive: plane; height: 0.4; width: 1.2" position="-1.45 0.7 -1" material="color: gray; opacity: 0.5" id="hazardID"></a-entity>
            <a-entity geometry="primitive: plane; height: 0.4; width: 1.2" position="1.40 0.7 -1" material="color: gray; opacity: 0.5" id="hazardID"></a-entity>
        </a-entity>

        <!--General scene entities--->

        <a-gradient-sky material="shader: gradient; topColor: 65 135 255; bottomColor: 183 210 255;"></a-gradient-sky>
        <a-grid id="ground" static-body="sphereRadius:NaN" material="src:#texture-floor;repeat:2 2" geometry="primitive:plane;width:500;height:200" rotation="0 0 0" position="0 0 1"></a-grid>
        <a-entity id="walls"></a-entity>

        <!--Scene 1 (Start Screen)--->
        <a-entity id="scene1">
            <a-gui-flex-container flex-direction="row" justify-content="center" align-items="normal" component-padding="5.1" opacity="0.7" position="-93 2 -13" rotation="0 270 0">
                <a-gui-button width="4.5" height="1.75" onclick="echoMe()" key-code="32" value= "START" font-size="200px">
                </a-gui-button>




            </a-gui-flex-container>
        </a-entity>

        <!-- <a-entity id="scene2">
            <a-box color="red" position="1 5 0" onclick="setSceneFarm2()"> </a-box>
        </a-entity>
         -->

        

        <a-light type="ambient" color="#f0ff93" intensity="0.8"></a-light>

    </a-scene>

<script>
    function echoMe(){
        console.log("Echo after me ah")
    }
  // function setSceneFarm() {
  //   document.getElementById('scene1').setAttribute('visible', 'true')
  //   document.getElementById('scene2').setAttribute('visible', 'true')
  // }

  // function setSceneFarm2() {
  //   document.getElementById('scene2').setAttribute('visible', 'false')
  //   document.getElementById('scene1').setAttribute('visible', 'true')
  // }
    AFRAME.registerComponent('automove-controls', {
        init: function () {
            this.speed = 0.1;
            this.isMoving = true;
            this.velocityDelta = new THREE.Vector3();
        },
        isVelocityActive: function () {
            return this.isMoving;
        },
        getVelocityDelta: function () {
            this.velocityDelta.z = this.isMoving ? -this.speed : 0;
            return this.velocityDelta.clone();
        }
    });


    document.querySelector('a-scene').addEventListener('render-target-loaded', function () {
        var WALL_SIZE = 5,
            WALL_HEIGHT = 3;
        var el = document.querySelector('#walls');
        var wall;


        for (var x = 0; x < map.height; x++)  {
            for (var y = 0; y < map.width; y++) {

                var i = y*map.width + x;
                var position = (x-map.width/2)*WALL_SIZE + ' ' + 1.5 + ' ' + (y-map.height/2)*WALL_SIZE;
                if (map.data[i] === 1) {
                    // Create wall
                    wall = document.createElement('a-box');
                    el.appendChild(wall);
                    wall.setAttribute('color', '#fff');
                    wall.setAttribute('material', 'src: #texture-wall;');
                    wall.setAttribute('width', WALL_SIZE);
                    wall.setAttribute('height', WALL_HEIGHT);
                    wall.setAttribute('depth', WALL_SIZE);
                    wall.setAttribute('position', position);
                    wall.setAttribute('static-body', '');
                }

                if (map.data[i] === 2)  {
                    // Set player position
                    document.querySelector('#player').setAttribute('position', position);
                }

            }
        }
        console.info('Walls added.');
    });
</script>
</body>
</html>
