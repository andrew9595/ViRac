<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>Virac</title>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://aframe.io/releases/0.8.2/aframe.min.js"></script>
    <script type="text/javascript">
        $.getJSON("environment.json", function( data ) {
            //Loading the sky variable
            AFRAME.registerComponent('mysky', {
                init:function(){
                    this.el.setAttribute('src','#' + data['environment']);
                }
            });
        });
    </script>
    <script src="https://cdn.rawgit.com/donmccurdy/aframe-extras/v4.2.0/dist/aframe-extras.min.js"></script> <!--Extra--->
    <script src="https://cdn.rawgit.com/zcanter/aframe-gradient-sky/master/dist/gradientsky.min.js"></script> <!--Weather--->
    <script src="https://rawgit.com/rdub80/aframe-gui/master/dist/aframe-gui.min.js"></script> <!--GUI--->
    <script src="https://rawgit.com/atomicguy/aframe-fence-component/master/dist/aframe-fence-component.min.js"></script>

</head>

<body>
    <a-scene>
        <a-assets>
            <!-- All images assets -->
            <img id="sky" src="images/environment/sky.png">
            <img id="night" src="images/environment/night.jpg">
            <img id="rain" src="images/environment/rain.jpg">
            <img id="road" src="images/environment/road.jpg">
            <img id="sideroad" src="images/environment/sideroad.jpg">
            <img id="grass" src="images/environment/grass.jpg">
            <img id="cpavement" src="images/environment/cycling_pavement.jpg">
            <img id="walkway" src="images/environment/walkway.jpg">
            <img id="segway" src="images/menu/segway.png">
            <img id="bicycle" src="images/menu/bicycle.png">
            <img id="barrier" src="images/environment/barrier.png">
            <img id="hdb" src="images/environment/hdb.png">
            <img id="hdbg" src="images/environment/hdbg.png">
            <img id="park" src="images/environment/park.png">

            <!-- All menu images assets -->
            <img id="chevronup" src="images/menu/chevronup.png">

            <!-- 3D assets -->
            <a-asset-item id="bicycle_obj" src="models/bike/bicycle.obj"></a-asset-item>
            <a-asset-item id="bicycle_mtl" src="models/bike/bicycle1.mtl"></a-asset-item>
            <a-asset-item id="redcar_obj" src="models/redcar/model.obj"></a-asset-item>
            <a-asset-item id="redcar_mtl" src="models/redcar/materials.mtl"></a-asset-item>
            <a-asset-item id="oldman_obj" src="models/oldman/model.obj"></a-asset-item>
            <a-asset-item id="oldman_mtl" src="models/oldman/materials.mtl"></a-asset-item>
            <a-asset-item id="boy_obj" src="models/boy/model.obj"></a-asset-item>
            <a-asset-item id="boy_mtl" src="models/boy/materials.mtl"></a-asset-item>


        </a-assets>



        <!-- Sky -->
        <a-sky mysky src="#sky"></a-sky>

        <!-- Barrier -->
        <a-box repeat="3 1" src="#barrier" position="0 1 10" rotation="0 0 0" width="15" height="1.5"></a-box>

        <!-- Roads -->
        <a-plane repeat="1 10" src="#road" position="0 0 -4" rotation="-90 0 0" width="10" height="96" color="#7BC8A4" shadow></a-plane>
        <a-plane repeat="1 10" src="#road" position="50 0 -57" rotation="-90 -90 0" width="10" height="230" color="#7BC8A4" shadow></a-plane>
        <a-plane repeat="1 10" src="#road" position="159.1 0 -4" rotation="-90 0 0" width="10" height="96" color="#7BC8A4" shadow></a-plane>

        <!-- Side Road -->
        <a-plane repeat="1 50" src="#sideroad" position="5.2 0 -4" rotation="-90 0 0" width="0.6" height="95" color="#7BC8A4" shadow></a-plane>
        <a-plane repeat="1 50" src="#sideroad" position="-5.2 0 -4" rotation="-90 0 0" width="0.6" height="96" color="#7BC8A4" shadow></a-plane>
        <a-plane repeat="1 50" src="#sideroad" position="55 0 -51.8" rotation="-90 90 0" width="0.6" height="190" color="#7BC8A4" shadow></a-plane>
        <a-plane repeat="1 50" src="#sideroad" position="55 0 -62.2" rotation="-90 90 0" width="0.6" height="190" color="#7BC8A4" shadow></a-plane>
        <a-plane repeat="1 50" src="#sideroad" position="153.8 0 48" rotation="-90 0 0" width="0.6" height="200" color="#7BC8A4" shadow></a-plane>
        <a-plane repeat="1 50" src="#sideroad" position="164.2 0 48" rotation="-90 0 0" width="0.6" height="200" color="#7BC8A4" shadow></a-plane>

        <!-- Grass -->
        <a-plane repeat="1 100" src="#grass" position="7 0 -4" rotation="-90 0 0" width="3" height="95" color="#7BC8A4" shadow></a-plane>
        <a-plane repeat="1 100" src="#grass" position="-7 0 -4" rotation="-90 0 0" width="3" height="96" color="#7BC8A4" shadow></a-plane>
        <a-plane repeat="1 100" src="#grass" position="152 0 -4" rotation="-90 0 0" width="3" height="95" color="#7BC8A4" shadow></a-plane>
        <a-plane repeat="1 100" src="#grass" position="50 0 -70" rotation="-90 -90 0" width="15" height="230" shadow></a-plane>

        <!-- Pavement -->
        <a-plane repeat="1 100" src="#cpavement" position="11 0 -4" rotation="-90 0 0" width="5" height="85" color="#7BC8A4" shadow></a-plane>
        <a-plane repeat="1 100" src="#cpavement" position="-11 0 -4" rotation="-90 0 0" width="5" height="96" color="#7BC8A4" shadow></a-plane>
        <a-plane repeat="1 100" src="#cpavement" position="79.5 0 -49" rotation="-90 90 0" width="5" height="142" color="#7BC8A4" shadow></a-plane>
        <a-plane repeat="1 100" src="#cpavement" position="148 0 13" rotation="-90 0 0" width="5" height="120" color="#7BC8A4" shadow></a-plane>

        <!-- Walkway -->
        <a-plane repeat="1 100" src="#walkway" position="16 0 -4" rotation="-90 0 0" width="5" height="85" color="#7BC8A4" shadow></a-plane>
        <a-plane repeat="1 100" src="#walkway" position="-16 0 -4" rotation="-90 0 0" width="5" height="96" color="#7BC8A4" shadow></a-plane>
        <a-plane repeat="1 100" src="#walkway" position="79 0 -44" rotation="-90 90 0" width="5" height="123" color="#7BC8A4" shadow></a-plane>
        <a-plane repeat="1 100" src="#walkway" position="143 0 13.5" rotation="-90 0 0" width="5" height="120" color="#7BC8A4" shadow></a-plane>

        <!-- Building -->
        <a-box repeat= "3 3" src="#hdb" position="19 30 10" rotation="0 90 0" width="100" height="60"></a-box>
        <a-box repeat= "3 3" src="#hdb" position="-19 30 -4" rotation="0 90 0" width="120" height="60"></a-box>
        <a-box repeat= "3 3" src="#hdb" position="78.5 30 -41" rotation="0 0 0" width="120" height="60"></a-box>
        <a-box repeat= "3 3" src="#hdb" position="140 30 19" rotation="0 90 0" width="120" height="60"></a-box>
        <a-box repeat= "5 1" src="#park" position="165.06 5 19" rotation="0 90 0" width="200" height="20" transparent="true"></a-box>

        <!-- Finish line -->
        <a-box position="90 15 -53" rotation="0 90 0" width="40" height="10" color="#FFDA03">
            <a-text width="150" value="Finish" font="monoid" position="15 1 -1" rotation="0 180 0" color="#2B2B2B"></a-text>
        </a-box>
        <a-gui-flex-container id="tLookTL" flex-direction="row" justify-content="center" align-items="normal" opacity="0" width="9" height="4.5" position="90 5 -56" rotation="0 270 0" panel-color="#FFDA03">
                <a-gui-button
                        width="11" height="8"
                        onclick="toMainMenu()"
                        icon="social-github"
                        value="Back to Main Menu"
                        font-family="Impact"
                        background-color="#FFDA03"
                        font-size="300px"
                        font-color="#000"
                        border-color="#000"
                        hover-color="#DD9E00"
                        border-width="2"> 
                </a-gui-button>
            </a-gui-flex-container>
        <a-cone position="90 0 -45" rotation="0 90 0" width="100" height="40" color="#FFDA03"></a-cone>
        <a-cone position="90 0 -68" rotation="0 90 0" width="100" height="40" color="#FFDA03"></a-cone>

        <!-- Traffic Light -->
        <a-cylinder position="-10 0 -50" rotation="0 90 0" width="10" height="20" color="#ccd4e2" radius="0.5">
            <a-box position="0 10 7" rotation="0 90 90" width="3" height="15" color="#303030">
                <a-circle id="red" position="0 5.5 -1" rotation="0 180 0" width="3" height="7" color="#ff1d00" visible="false"></a-circle>
                <a-circle id="yellow" position="0 3 -1" rotation="0 180 0" width="3" height="7" color="#ffb200" visible="false"></a-circle>
                <a-circle id="green" position="0 0.5 -1" rotation="0 180 0" width="3" height="7" color="#13e500" visible="false"></a-circle>
            </a-box>
        </a-cylinder>

        <!-- Background -->
        <a-box repeat= "10 1" src="#hdbg" position="5 19 -80" rotation="0 0 0" width="1000" height="40" transparent="true"></a-box>

        <!-- Camera -->
        <a-entity id="player_bicycle" position="0.25 1.5 -2.5" camera look-controls wasd-controls="acceleration: 500"
        body="type: static; mass: 5; shape: none;"
        shape__main="shape: cylinder;
                     height: 0.36;
                     radiusTop: 0.24;
                     radiusBottom: 0.24;"
        shape__handle="shape: box;
                       halfExtents: 0.15 0.18 0.04;
                       offset: 0.4 0 0;">
          <a-entity cursor="fuse: true; fuseTimeout: 1000"
                               position="0 0 -1"
                               geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03"
                               material="color: black; shader: flat">
                               <a-animation begin="click" easing="ease-in" attribute="scale"
                                    fill="backwards" from="0.1 0.1 0.1" to="1 1 1"></a-animation>
                               <a-animation begin="cursor-fusing" easing="ease-in" attribute="scale"
                                    fill="forwards" from="1 1 1" to="0.1 0.1 0.1"></a-animation>
            </a-entity>

            <a-entity geometry="primitive: plane; height: 0.4; width: 1.2" position="-1.45 0.7 -1" material="color: gray; opacity: 0.8">
                <a-text value="Level 0" position="-0.2 0.05 0" color="#FFF" width="1"></a-text>
                <a-text value="ViRAC tutorial" position="-0.2 -0.03 0" color="#FFDA03" width="1.5"></a-text>
            </a-entity>

            <a-entity playerbike id="playerbike">
                <a-obj-model position="0 -2 -0.1"  src="#bicycle_obj" mtl="#bicycle_mtl" scale="0.1 0.1 0.1" rotation="0 175 0"></a-obj-model>
            </a-entity>

            <!-- Animation-->
          <a-animation id="path1" begin="path1" attribute="position" from="0.25 1.5 -2.5" to="0.25 1.5 -36.5" dur="10000"></a-animation>
          <a-animation id="path2" begin="path2" attribute="position" from="0.25 1.5 -36.5" to="0.25 1.5 -56.8" dur="10000"></a-animation>
          <a-animation id="path3" begin="path3" attribute="position" from="0.25 1.5 -56.8" to="25 1.5 -56.8" dur="10000"></a-animation>
          <a-animation id="path4" begin="path4" attribute="position" from="25 1.5 -56.8" to="55 1.5 -56.8" dur="10000"></a-animation>
          <a-animation id="path5" begin="path5" attribute="position" from="55 1.5 -56.8" to="75 1.5 -56.8" dur="10000"></a-animation>

          <a-entity id="pauseWindow" geometry="primitive: plane; height: 3; width: 5.5" position="0 0.7 -0.5" material="color: gray; opacity: 0.8" visible="false"> 
            <a-text value="PAUSE" position="-0.35 -0.7 0.1" color="#FFF" width="1" scale="5 5 5"></a-text>
            <a-text value="Press P again to resume" position="-0.18 -0.85 0.1" color="#FFF" width="0.7 0.7 0.7"></a-text>
            <a-text value="Press Q again to return back to menu" position="-0.25 -0.9 0.1" color="#FFF" width="0.7 0.7 0.7"></a-text>
         </a-entity>
          
        </a-entity>

        <!-- Path 1 -->
        <a-gui-flex-container flex-direction="row" justify-content="center" align-items="normal" opacity="0" width="2" height="2" position="0.25 -0.1 -10" rotation="-90 0 0" panel-color="#FFDA03">
            <a-gui-button 
                width="5" height="5"
                onclick="path1()"
                value="_"
                font-family="Arial"
                margin="0 0 0.05 0"
                background-color="#2d2d2d">
                <a-image src="#chevronup" width="4" height="4" position="0 0 0.25"></a-image>
            </a-gui-button>
        </a-gui-flex-container>

        <!-- Path 2 -->
        <a-gui-flex-container flex-direction="row" justify-content="center" align-items="normal" opacity="0" width="2" height="2" position="0.25 -0.1 -42" rotation="-90 0 0" panel-color="#FFDA03">
            <a-gui-button 
                width="5" height="5"
                onclick="path2()"
                value="_"
                font-family="Arial"
                margin="0 0 0.05 0"
                background-color="#2d2d2d">
                <a-image src="#chevronup" width="4" height="4" position="0 0 0.25"></a-image>
            </a-gui-button>
        </a-gui-flex-container>

        <!-- Path 3 -->
        <a-gui-flex-container flex-direction="row" justify-content="center" align-items="normal" opacity="0" width="2" height="2" position="10 -0.1 -56.8" rotation="-90 -90 0" panel-color="#FFDA03">
            <a-gui-button 
                width="5" height="5"
                onclick="path3()"
                value="_"
                font-family="Arial"
                margin="0 0 0.05 0"
                background-color="#2d2d2d">
                <a-image src="#chevronup" width="4" height="4" position="0 0 0.25"></a-image>
            </a-gui-button>
        </a-gui-flex-container>

        <!-- Path 4 -->
        <a-gui-flex-container flex-direction="row" justify-content="center" align-items="normal" opacity="0" width="2" height="2" position="30 -0.1 -56.8" rotation="-90 -90 0" panel-color="#FFDA03">
            <a-gui-button 
                width="5" height="5"
                onclick="path4()"
                value="_"
                font-family="Arial"
                margin="0 0 0.05 0"
                background-color="#2d2d2d">
                <a-image src="#chevronup" width="4" height="4" position="0 0 0.25"></a-image>
            </a-gui-button>
        </a-gui-flex-container>

        <!-- Path 5 -->
        <a-gui-flex-container flex-direction="row" justify-content="center" align-items="normal" opacity="0" width="2" height="2" position="60 -0.1 -56.8" rotation="-90 -90 0" panel-color="#FFDA03">
            <a-gui-button 
                width="5" height="5"
                onclick="path5()"
                value="_"
                font-family="Arial"
                margin="0 0 0.05 0"
                background-color="#2d2d2d">
                <a-image src="#chevronup" width="4" height="4" position="0 0 0.25"></a-image>
            </a-gui-button>
        </a-gui-flex-container>
        
        <!-- Start menu -->
        <a-entity id="tStart">  
            <a-gui-flex-container flex-direction="row" justify-content="center" align-items="normal" opacity="0" width="9" height="2" position="0.2 2.8 -6" rotation="0 0 0" panel-color="#FFDA03">
                <a-gui-label 
                    width="4" height="2"
                    value="Tutorial"
                    font-family="Impact"
                    font-size = "200px"
                    margin="0 0 0.0 0"
                    font-color="#000"
                    background-color="#FFDA03">
                    <a-text value="Follow the road and complete the tutorial" position="-1.2 -0.5 0" color="#000" width="3"></a-text>
                    <a-text value="Press 'P' to pause and 'Q' to quit" position="-0.6 -0.65  0" color="#000" width="2"></a-text>
                </a-gui-label>
            </a-gui-flex-container>
        </a-entity>

        <!-- Look menu -->
        <a-entity id="tLookAround">
            <a-gui-flex-container id="tLookTLL" flex-direction="row" justify-content="center" align-items="normal" opacity="0" width="9" height="4.5" position="-5 3.65 -45" rotation="0 0 0" panel-color="#FFDA03">
                <a-gui-button
                        width="2" height="0.75"
                        onclick="tLookDissapear('tLookTLL')"
                        value="Look here"
                        font-family="Impact"
                        background-color="#FFF"
                        font-color="#000"
                        border-color="#000"
                        hover-color="#DD9E00"
                        border-width="2"> 
                </a-gui-button>
            </a-gui-flex-container>
        	<a-gui-flex-container id="tLookTBL" flex-direction="row" justify-content="center" align-items="normal" opacity="0" width="9" height="4.5" position="-5 1.65 -45" rotation="0 0 0" panel-color="#FFDA03">
        		<a-gui-button
                        width="2" height="0.75"
                        onclick="tLookDissapear('tLookTBL')"
                        icon="social-github"
                        value="Look here"
                        font-family="Impact"
                        background-color="#FFF"
                        font-color="#000"
                        border-color="#000"
                        hover-color="#DD9E00"
                        border-width="2"> 
                </a-gui-button>
        	</a-gui-flex-container>	
            <a-gui-flex-container flex-direction="row" justify-content="center" align-items="normal" opacity="0" width="9" height="4.5" position="0 2.5 -45" rotation="0 0 0" panel-color="#FFDA03">
                <a-gui-label 
                    width="8" height="2"
                    value="Looking Around"
                    font-family="Impact"
                    font-size = "200px"
                    margin="0 0 0.0 0"
                    font-color="#000"
                    background-color="#FFDA03">
                    <a-text value="By hovering over the white panels" position="-1.2 -0.7 0.5" color="#000" width="4"></a-text>
                </a-gui-label>
            </a-gui-flex-container>
            <a-gui-flex-container id="tLookTR" flex-direction="row" justify-content="center" align-items="normal" opacity="0" width="9" height="4.5" position="5 3.35 -45" rotation="0 0 0" panel-color="#FFDA03">
        		<a-gui-button
                        width="2" height="0.75"
                        onclick="tLookDissapear('tLookTR')"
                        icon="social-github"
                        value="Look here"
                        font-family="Impact"
                        background-color="#FFF"
                        font-color="#000"
                        border-color="#000"
                        hover-color="#DD9E00"
                        border-width="2"> 
                </a-gui-button>
        	</a-gui-flex-container>
        	<a-gui-flex-container id="tLookBR" flex-direction="row" justify-content="center" align-items="normal" opacity="0" width="9" height="4.5" position="5 1.65 -45" rotation="0 0 0" panel-color="#FFDA03">
        		<a-gui-button
                        width="2" height="0.75"
                        onclick="tLookDissapear('tLookBR')"
                        icon="social-github"
                        value="Look here"
                        font-family="Impact"
                        background-color="#FFF"
                        font-color="#000"
                        border-color="#000"
                        hover-color="#DD9E00"
                        border-width="2"> 
                </a-gui-button>
        	</a-gui-flex-container>	
        </a-entity>

        <!-- Vehicle menu -->
        <a-entity id="tDontHitCar">  
			<a-gui-flex-container flex-direction="row" justify-content="center" align-items="normal" opacity="0" width="9" height="4.5" position="30 2.8  -56" rotation="0 -90 0" panel-color="#FFDA03">
	                <a-gui-label 
	                    width="8" height="2.5"
	                    value="Vehicles"
	                    font-family="Impact"
	                    justify-content="center"
	                    font-size="200px"
	                    margin="0 0 0.0 0"
	                    font-color="#000"
	                    background-color="#FFDA03">
	                    <a-text value="Do not to collide with any oncoming vehicles.. Your life is at stake!" position="-2.5 -0.7 0" color="#000"></a-text>
	                </a-gui-label>
	        </a-gui-flex-container>
	                     <!-- Lambo -->
	       <a-entity>
	          <a-obj-model src="#lambo_obj" mtl="#lambo_mtl" position="30 0 -55" rotation="0 0 0"></a-obj-model>
	        </a-entity>
        </a-entity>

        <!-- Pedestrian menu -->
        <a-entity id="tDontHitPedestrian">  
			<a-gui-flex-container flex-direction="row" justify-content="center" align-items="normal" opacity="0" width="9" height="4.5" position="60 2.5 -56" rotation="0 -90 0" panel-color="#FFDA03">
	                <a-gui-label 
	                    width="8" height="2"
	                    value="Pedestrians"
	                    font-family="Impact"
	                    justify-content="center"
	                    font-size = "200px"
	                    margin="0 0 0.0 0"
	                    font-color="#000"
	                    background-color="#FFDA03">
	                    <a-text value="This is a pedestrian.. Try not to collide with one.. Their life is at stake!" position="-2.5 -0.7 0" color="#000"></a-text>
	                </a-gui-label>
	        </a-gui-flex-container>
	       <a-entity>
	          <a-obj-model src="#pedestrian_obj" mtl="#pedestrian_mtl" position="60 0 -55" rotation="0 0 0"></a-obj-model>
	        </a-entity>
        </a-entity>

        
        <a-obj-model src="#redcar_obj" mtl="#redcar_mtl" position="28 1 -51" rotation="0 200 0" scale="4 4 4"></a-obj-model>
        <a-obj-model src="#oldman_obj" mtl="#oldman_mtl" position="60 1 -51" rotation="0 200 0" scale="5 5 5"></a-obj-model>
        <a-obj-model src="#boy_obj" mtl="#boy_mtl" position="59 1 -51" rotation="0 0 0" scale="5 5 5"></a-obj-model>

    </a-scene>
</body>
</html>

<script>

    AFRAME.registerComponent("foo", {
        init: function() {
          this.el.addEventListener("hitstart", (e) => {
            console.log('Hello, World!');
            document.getElementById('parkingmenu').setAttribute('visible','true');
          })
        }
    })

    function path1(){
        document.getElementById('player_bicycle').emit('path1')  
    }

    function path2(){
        document.getElementById('player_bicycle').emit('path2')  
    }

    function path3(){
        document.getElementById('player_bicycle').emit('path3')  
    }

    function path4(){
        document.getElementById('player_bicycle').emit('path4')  
    }

    function path5(){
        document.getElementById('player_bicycle').emit('path5')  
    }

    //Set stage 
    setStage();

    //Set the stage of page assets on load
    function setStage(){
        //greenLight();
    }

    // Button href links
    function toStageselect(){
        window.location.replace("stageselect.html");
    }

    function toMainMenu(){
        window.location.replace("index.html");
    }

     function toTutorial(){
        window.location.replace("tutorial.html");
    }

     function toDesignerint(){
        window.location.replace("designer.html");
    }

    function tLookDissapear(lookBoxID){
       document.getElementById(lookBoxID).setAttribute('visible', 'false');
    }

    function greenLight() {
        setTimeout(function(){
            document.getElementById('red').setAttribute('visible', 'false');
            document.getElementById('yellow').setAttribute('visible', 'false');
            document.getElementById('green').setAttribute('visible', 'true');
            console.log('Green Light activated');
            yellowLight();  
        }, 12000);   
    }

    function yellowLight() {
        setTimeout(function(){
            document.getElementById('red').setAttribute('visible', 'false');
            document.getElementById('yellow').setAttribute('visible', 'true');
            document.getElementById('green').setAttribute('visible', 'false');
            console.log('Yellow Light activated');
            redLight();
        }, 8000);    
    }

    function redLight() {
        setTimeout(function(){
            document.getElementById('red').setAttribute('visible', 'true');
            document.getElementById('yellow').setAttribute('visible', 'false');
            document.getElementById('green').setAttribute('visible', 'false');
            console.log('Red Light activated');
            greenLight()
        }, 2000);
    }
</script>
<script src="js/pause.js"></script>